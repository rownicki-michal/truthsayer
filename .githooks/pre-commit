#!/bin/sh
# .git/hooks/pre-commit
# Runs before every commit: format, lint, vet, test.
# Install: cp .githooks/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -e

echo "==> Checking formatting (gofmt)..."
UNFORMATTED=$(gofmt -l .)
if [ -n "$UNFORMATTED" ]; then
    echo "The following files are not formatted:"
    echo "$UNFORMATTED"
    echo "Run: gofmt -w ."
    exit 1
fi

echo "==> Running go vet..."
go vet ./...

echo "==> Running staticcheck..."
if command -v staticcheck >/dev/null 2>&1; then
    staticcheck ./...
else
    echo "   staticcheck not found â€” skipping (install: go install honnef.co/go/tools/cmd/staticcheck@latest)"
fi

echo "==> Running tests..."
go test -race -count=1 ./...

echo "==> All checks passed."
